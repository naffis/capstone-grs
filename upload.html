---
layout: default
---  
{% include navbar-blue.html %}

<script src="{{site.baseurl}}/js/jquery-2.1.3.js"></script>
<script src="{{site.baseurl}}/js/oauth.js"></script>
<script src="{{site.baseurl}}/js/github.js"></script>
<!-- <script src="{{site.baseurl}}/js/papaparse.js"></script>
<script src="{{site.baseurl}}/js/csv.js"></script>
 -->
<script>    
  var access_token;
  var file;
  var filename;
  var file_content;
  
  function handleFileSelect(f) {
    if (f.type.match(/.(pdf)$/)) {
      filename = f.name;
      file = f;
     
      if(access_token !=  null) {
        document.getElementById("save").style.display = '';
      }

    } 
    else {
      console.log("File not supported.");
    }
  }

 
  $(document).ready(function() {
    $("#the-file-input").change(function() {                      
      handleFileSelect(this.files[0]);
    });

    // $("#csv-file").change(handleFileSelect);
    authenticated();
  });


  $.urlParam = function(name) {
    var results = new RegExp('[\?&]' + name + '=([^&#]*)').exec(window.location.href);
    if (results==null) {
      return null;
    } 
    else {
      return results[1] || 0;
    }
  }

  function authenticated() {
    access_token = $.urlParam('access_token');
    
    if(access_token !=  null) {
      //document.getElementById('access_token').value = access_token;    
      document.getElementById("login").style.display = 'none';
      // document.getElementById("save").style.display = '';
    }  
    else {
      document.getElementById("save").style.display = 'none';
      document.getElementById("login").style.display = '';
    }                       
  }
  
  function saveFile() {    
    var github = new Github({
      token: access_token,
      auth: "oauth"
    });

    var repo = github.getRepo('naffis', 'capstone-grs');
    alert(filename);
    alert(file.name);

    var reader = new FileReader();
    reader.onload = function(e) {
      var file_content = reader.result;
    };
    reader.onerror = function(e) {
      console.log("Error", e);  
    };
    // reader.readAsDataURL(file);
    reader.readAsBinaryString(file); 

    repo.write('master', '/forms/'+filename, 'test', 'Saving data file ' + filename, function(err) {});        
  }       

</script>  


<div class="col-md-12">
  <div class="row">

    <div id="login" style="display: none;">  
      <p align="center">
        <a href="{{site.baseurl}}/login.html">Login</a>
      </p>
    </div>
    
    <p align="center">
  	  <input id="the-file-input" type="file">
    </p>

    <p>
      <div id="save" style="display: none;"> 
        <p align="center"><a href="#" onclick="saveFile();">Save</a></p>
      </div>    
    </p>
  </div>
</div>

  

